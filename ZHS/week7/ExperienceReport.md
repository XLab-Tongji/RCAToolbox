# Experience Report: Anomaly Detection of Cloud Application Operations Using Log and Cloud Metric Correlation Analysis

## 整体框架
<div align="center">
<img src="https://raw.githubusercontent.com/XLab-Tongji/RCAToolbox/File/ZHS/week7/extract_correlation_between_logs_and_metrics.png" width=50%>
</div>


## 简介
采用回归分析法识别资源状态和程序行为之间的相关性

然后根据导出的相关性模型分析系统实际行为和预期行为之间的对比.

贡献:
- 通过权重计时和相关系数对低粒度日志进行聚类,应用回归模型分析程序行为和cloud metric改变之间的关系
- 基于相关、因果模型,定义断言归约作为预期行为的预测工具
- 在理想数据集上进行评估

## 概述
假设存在一个时间标记的事件流

日志表示应用程序操作的行为,而指标表示系统的状态

## 方法
### 数据收集和指标导出

### 将事件Log映射到Metric数据
Metric的粒度大于一分钟,而Log的可以是几分或者几秒,因此需要进行映射,将每分钟长时间窗口内发生的事件日志类型的**发生强度**插值到相应的分钟.

发生强度即事件发生前后的时间相关度,如发生在X分30秒的事件E1在X分和X+1分的发生强度均为0.5,X分15秒的发生强度为0.75

### 日志事件聚类
我们将记录的事件聚集到更高级别的活动中,原因有两个:
- 日志通常是低级别和大量的;通过提高抽象级别,用户可能会发现提供的信息更有用.
- 如果一组事件类型总是同时发生,那么它们之间的高度相关性会导致某些统计模型中的多重线性问题,这可能导致不可靠和不稳定的估计.

使用Pearson积矩相关系数来推导日志事件间的关联强度,将系数高的分为一组,称一个活动.

### 统计事件指标相关性导出
合理假设:日志行为以及其对VM状态(即资源)的影响存在线性关系

利用最小二乘法进行多元回归

## 实验结果和评估
### 日志聚类
计算Pearson相关系数,将系数大于0.75的事件类型分为一组,作为一个活动

### 相关性及因果分析
使用滚动升级操作,测试模型的适用性.

为了调查回归模型中事件类型和云指标的关系,将日志聚类导出的活动作为预测变量,实例的启动和结束作为两个因变量

拟合得很好

### 预测及故障检测
从多元回归模型导出的方程可用于预测最后一分钟内启动/终止实例的数量:给定观察到的日志行,应启动或终止多少虚拟机？
如果该预测值与实际值不匹配,则发出警报.目标是找出方法能够识别异常的准确程度.
工作范围集中在DevOps/零星操作上.对于此类操作,尤其是本研究中使用的滚动升级案例研究,VM的状态是异常的主要来源.因此,生成导致VM终止的故障类型而不是其他类型的故障是合理的.
